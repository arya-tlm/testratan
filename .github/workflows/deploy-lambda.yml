name: Deploy Lambda Functions

on:
  push:
    branches: [ main, master ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v2
      with:
        aws-access-key-id: ${{ secrets.ACCESS_KEY }}
        aws-secret-access-key: ${{ secrets.SECRET_ACCESS_KEY }}
        aws-region: ap-south-1

    - name: List files for debugging
      run: |
        echo "Files in repository:"
        ls -la *.py
        echo "Git status:"
        git status

    - name: Deploy test_github function
      run: |
        echo "Deploying test_github function"
        
        # Check if file exists
        if [ ! -f "test_github.py" ]; then
          echo "Error: test_github.py not found!"
          exit 1
        fi
        
        # Create deployment package
        cp test_github.py lambda_function.py
        zip lambda-deployment.zip lambda_function.py
        
        # Deploy to AWS
        aws lambda update-function-code \
          --function-name test_github \
          --zip-file fileb://lambda-deployment.zip
        
        echo "âœ… Successfully deployed test_github"
        
        # Clean up
        rm lambda_function.py lambda-deployment.zip